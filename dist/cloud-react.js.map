{"version":3,"file":"cloud-react.js","sources":["../src/use-callback-ref.ts","../src/use-cloud.ts","../src/use-optional-ref.ts","../src/use-resize-observer.ts"],"sourcesContent":["import { useRef, useCallback } from 'react';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type AnyFunction = (...args: any[]) => any;\n\n/**\n * Convert an unstable function reference into a function wrapper with stable reference that\n * calls the latest instance of unstable function\n */\nexport function useCallbackRef<T extends AnyFunction>(unstableFn?: T): AnyFunction {\n  const ref = useRef(unstableFn);\n  ref.current = unstableFn;\n  return useCallback((...args: Parameters<T>) => ref.current?.(...args), [ref]);\n}\n","import { Cloud, CloudOptions, CloudPoint } from '@alesmenzel/cloud';\nimport { useEffect, useMemo, useState } from 'react';\nimport { useCallbackRef } from './use-callback-ref';\n\nexport type Timeout = ReturnType<typeof setTimeout>;\nexport type UseCloudPoint<Item> = CloudPoint & {\n  index: number;\n  item: Item;\n};\nexport type UseCloudReturn<Item> = {\n  cloud: Cloud<Item>;\n  points: UseCloudPoint<Item>[];\n  allCalculated: boolean;\n};\nexport type UseCloudOptions<Item> = CloudOptions<Item> & {\n  items: Item[];\n  delay?: number;\n  transform?: (item: Item) => Item;\n  onInvalidPlacement?: (item: Item) => CloudPoint | null;\n};\n\nexport function useCloud<Item>(options: UseCloudOptions<Item>): UseCloudReturn<Item> {\n  const [points, setPoints] = useState<UseCloudPoint<Item>[]>([]);\n  const [cloud] = useState(() => new Cloud<Item>(options));\n  const [allCalculated, setAllCalculated] = useState(!options.items.length);\n\n  const {\n    width,\n    height,\n    items,\n    delay,\n    transform,\n    onInvalidPlacement,\n    randomizer,\n    collider,\n    attempts,\n  } = options;\n\n  const transformStable = useCallbackRef(transform);\n  const onInvalidPlacementStable = useCallbackRef(onInvalidPlacement);\n\n  // Calculate the item positions\n  useEffect(() => {\n    if (!items.length) {\n      setAllCalculated(false);\n      setPoints([]);\n      return undefined;\n    }\n\n    setAllCalculated(false);\n    setPoints([]);\n    cloud.update({ width, height, attempts, randomizer, collider });\n\n    let i = 0;\n    let animationHandle: number;\n    let timeout: Timeout;\n\n    function calculate() {\n      const item = transformStable ? transformStable(items[i]) : items[i];\n\n      let point = cloud.next(item);\n\n      if (!point && onInvalidPlacementStable) {\n        point = onInvalidPlacementStable(item);\n      }\n\n      if (point) {\n        const newPoint: UseCloudPoint<Item> = { index: i, ...point, item };\n        setPoints((points) => [...points, newPoint]);\n      }\n\n      i += 1;\n      if (i < items.length) {\n        if (delay !== undefined) {\n          timeout = setTimeout(() => {\n            animationHandle = requestAnimationFrame(calculate);\n          }, delay);\n        } else {\n          animationHandle = requestAnimationFrame(calculate);\n        }\n      } else {\n        setAllCalculated(true);\n      }\n    }\n\n    animationHandle = requestAnimationFrame(calculate);\n\n    return () => {\n      cancelAnimationFrame(animationHandle);\n      clearTimeout(timeout);\n    };\n  }, [\n    items,\n    cloud,\n    delay,\n    width,\n    height,\n    attempts,\n    transformStable,\n    onInvalidPlacementStable,\n    collider,\n    randomizer,\n  ]);\n\n  return useMemo<UseCloudReturn<Item>>(\n    () => ({\n      cloud,\n      points,\n      setPoints,\n      allCalculated,\n    }),\n    [cloud, points, allCalculated]\n  );\n}\n","import { RefCallback, RefObject, useRef } from 'react';\n\nexport function useOptionalRef<T>(ref?: RefCallback<T>): RefCallback<T>;\nexport function useOptionalRef<T>(ref?: RefObject<T>): RefObject<T>;\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport function useOptionalRef<T>(ref?: any): any {\n  const newRef = useRef<T>(null);\n  return ref ?? newRef;\n}\n","import { RefObject, useCallback, useEffect, useState } from 'react';\nimport { useOptionalRef } from './use-optional-ref';\n\nexport type UseResizeObserverSize = {\n  width: number;\n  height: number;\n};\nexport type UseResizeObserverOptions<El extends Element = Element> = {\n  width?: number;\n  height?: number;\n  ref?: RefObject<El>;\n  onResize?: (size: UseResizeObserverSize) => void;\n};\nexport type UseResizeObserverReturn<El extends Element = Element> = UseResizeObserverSize & {\n  ref: RefObject<El>;\n};\n\nexport function useResizeObserver<El extends Element = Element>({\n  ref,\n  width = 100,\n  height = 100,\n  onResize,\n}: UseResizeObserverOptions<El> = {}): UseResizeObserverReturn<El> {\n  const el = useOptionalRef<El>(ref);\n  const [size, setSize] = useState<UseResizeObserverSize>({\n    width,\n    height,\n  });\n\n  const updateSize = useCallback(\n    (size: UseResizeObserverSize) => {\n      setSize(size);\n      onResize?.(size);\n    },\n    [onResize]\n  );\n\n  // Update the dimensions\n  useEffect(() => {\n    if (!el.current) return undefined;\n\n    const { clientWidth, clientHeight } = el.current;\n    updateSize({ width: clientWidth, height: clientHeight });\n\n    const observer = new ResizeObserver((entries) => {\n      for (const entry of entries) {\n        if (entry.contentBoxSize) {\n          const contentBoxSize = Array.isArray(entry.contentBoxSize)\n            ? entry.contentBoxSize[0]\n            : entry.contentBoxSize;\n          updateSize({ width: contentBoxSize.inlineSize, height: contentBoxSize.blockSize });\n        }\n      }\n    });\n\n    observer.observe(el.current);\n    return () => {\n      observer.disconnect();\n    };\n  }, [el, updateSize]);\n\n  return { ref: el, ...size };\n}\n"],"names":["useCallbackRef","unstableFn","ref","useRef","current","useCallback","args","_a","call","useCloud","options","points","setPoints","useState","cloud","Cloud","allCalculated","setAllCalculated","items","length","width","height","delay","transform","onInvalidPlacement","randomizer","collider","attempts","transformStable","onInvalidPlacementStable","useEffect","update","animationHandle","timeout","i","requestAnimationFrame","calculate","item","point","next","newPoint","Object","assign","index","undefined","setTimeout","cancelAnimationFrame","clearTimeout","useMemo","useOptionalRef","newRef","useResizeObserver","onResize","el","size","setSize","updateSize","clientWidth","clientHeight","observer","ResizeObserver","entries","entry","contentBoxSize","Array","isArray","inlineSize","blockSize","observe","disconnect"],"mappings":"mKASM,SAAUA,EAAsCC,GACpD,MAAMC,EAAMC,EAAOF,GAEnB,OADAC,EAAIE,QAAUH,EACPI,GAAY,IAAIC,KAAuB,IAAAC,EAAC,OAAc,QAAdA,EAAAL,EAAIE,eAAU,IAAAG,OAAA,EAAAA,EAAAC,KAAAN,KAAGI,EAAK,GAAE,CAACJ,GAC1E,CCQM,SAAUO,EAAeC,GAC7B,MAAOC,EAAQC,GAAaC,EAAgC,KACrDC,GAASD,GAAS,IAAM,IAAIE,EAAYL,MACxCM,EAAeC,GAAoBJ,GAAUH,EAAQQ,MAAMC,SAE5DC,MACJA,EAAKC,OACLA,EAAMH,MACNA,EAAKI,MACLA,EAAKC,UACLA,EAASC,mBACTA,EAAkBC,WAClBA,EAAUC,SACVA,EAAQC,SACRA,GACEjB,EAEEkB,EAAkB5B,EAAeuB,GACjCM,EAA2B7B,EAAewB,GAiEhD,OA9DAM,GAAU,KACR,IAAKZ,EAAMC,OAGT,OAFAF,GAAiB,QACjBL,EAAU,IAIZK,GAAiB,GACjBL,EAAU,IACVE,EAAMiB,OAAO,CAAEX,QAAOC,SAAQM,WAAUF,aAAYC,aAEpD,IACIM,EACAC,EAFAC,EAAI,EAkCR,OAFAF,EAAkBG,uBA5BlB,SAASC,IACP,MAAMC,EAAOT,EAAkBA,EAAgBV,EAAMgB,IAAMhB,EAAMgB,GAEjE,IAAII,EAAQxB,EAAMyB,KAAKF,GAMvB,IAJKC,GAAST,IACZS,EAAQT,EAAyBQ,IAG/BC,EAAO,CACT,MAAME,EAAkCC,OAAAC,OAAAD,OAAAC,OAAA,CAAAC,MAAOT,GAAMI,GAAK,CAAED,SAC5DzB,GAAWD,GAAW,IAAIA,EAAQ6B,IACnC,CAEDN,GAAK,EACDA,EAAIhB,EAAMC,YACEyB,IAAVtB,EACFW,EAAUY,YAAW,KACnBb,EAAkBG,sBAAsBC,EAAU,GACjDd,GAEHU,EAAkBG,sBAAsBC,GAG1CnB,GAAiB,EAEpB,IAIM,KACL6B,qBAAqBd,GACrBe,aAAad,EAAQ,CACtB,GACA,CACDf,EACAJ,EACAQ,EACAF,EACAC,EACAM,EACAC,EACAC,EACAH,EACAD,IAGKuB,GACL,KAAO,CACLlC,QACAH,SACAC,YACAI,mBAEF,CAACF,EAAOH,EAAQK,GAEpB,CC5GM,SAAUiC,EAAkB/C,GAChC,MAAMgD,EAAS/C,EAAU,MACzB,OAAOD,QAAAA,EAAOgD,CAChB,UCSgBC,GAAgDjD,IAC9DA,EAAGkB,MACHA,EAAQ,IAAGC,OACXA,EAAS,IAAG+B,SACZA,GACgC,IAChC,MAAMC,EAAKJ,EAAmB/C,IACvBoD,EAAMC,GAAW1C,EAAgC,CACtDO,QACAC,WAGImC,EAAanD,GAChBiD,IACCC,EAAQD,GACRF,SAAAA,EAAWE,EAAK,GAElB,CAACF,IA2BH,OAvBAtB,GAAU,KACR,IAAKuB,EAAGjD,QAAS,OAEjB,MAAMqD,YAAEA,EAAWC,aAAEA,GAAiBL,EAAGjD,QACzCoD,EAAW,CAAEpC,MAAOqC,EAAapC,OAAQqC,IAEzC,MAAMC,EAAW,IAAIC,gBAAgBC,IACnC,IAAK,MAAMC,KAASD,EAClB,GAAIC,EAAMC,eAAgB,CACxB,MAAMA,EAAiBC,MAAMC,QAAQH,EAAMC,gBACvCD,EAAMC,eAAe,GACrBD,EAAMC,eACVP,EAAW,CAAEpC,MAAO2C,EAAeG,WAAY7C,OAAQ0C,EAAeI,WACvE,CACF,IAIH,OADAR,EAASS,QAAQf,EAAGjD,SACb,KACLuD,EAASU,YAAY,CACtB,GACA,CAAChB,EAAIG,IAERf,OAAAC,OAAA,CAASxC,IAAKmD,GAAOC,EACvB"}